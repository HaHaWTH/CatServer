--- a/net/minecraft/command/arguments/ArgumentTypes.java
+++ b/net/minecraft/command/arguments/ArgumentTypes.java
@@ -27,6 +_,10 @@
    private static final Logger LOGGER = LogManager.getLogger();
    private static final Map<Class<?>, ArgumentTypes.Entry<?>> BY_CLASS = Maps.newHashMap();
    private static final Map<ResourceLocation, ArgumentTypes.Entry<?>> BY_NAME = Maps.newHashMap();
+   // CatServer start - Support lightfall (https://github.com/IzzelAliz/Arclight/blob/1.16/arclight-common/src/main/java/io/izzel/arclight/common/mixin/core/command/arguments/ArgumentTypesMixin.java)
+   private static final Set<ResourceLocation> INTERNAL_TYPES = Sets.newHashSet();
+   private static boolean arclight$reentrant = false;
+   // CatServer end
 
    public static <T extends ArgumentType<?>> void register(String p_218136_0_, Class<T> p_218136_1_, IArgumentSerializer<T> p_218136_2_) {
       ResourceLocation resourcelocation = new ResourceLocation(p_218136_0_);
@@ -42,6 +_,7 @@
    }
 
    public static void bootStrap() {
+      INTERNAL_TYPES.addAll(BY_NAME.keySet()); // CatServer
       BrigadierSerializers.bootstrap();
       register("entity", EntityArgument.class, new EntityArgument.Serializer());
       register("game_profile", GameProfileArgument.class, new ArgumentSerializer<>(GameProfileArgument::gameProfile));
@@ -85,7 +_,13 @@
          register("test_argument", TestArgArgument.class, new ArgumentSerializer<>(TestArgArgument::testFunctionArgument));
          register("test_class", TestTypeArgument.class, new ArgumentSerializer<>(TestTypeArgument::testClassName));
       }
-
+      // CatServer start
+      Set<ResourceLocation> set = new java.util.HashSet<>(BY_NAME.keySet());
+      set.removeAll(INTERNAL_TYPES);
+      INTERNAL_TYPES.addAll(set);
+      INTERNAL_TYPES.add(new ResourceLocation("forge", "enum"));
+      INTERNAL_TYPES.add(new ResourceLocation("forge", "modid"));
+      // CatServer end
    }
 
    @Nullable
@@ -104,8 +_,25 @@
          LOGGER.error("Could not serialize {} ({}) - will not be sent to client!", p_197484_1_, p_197484_1_.getClass());
          p_197484_0_.writeResourceLocation(new ResourceLocation(""));
       } else {
+         // CatServer start
+         boolean wrap;
+         if (!arclight$reentrant && org.spigotmc.SpigotConfig.bungee && !INTERNAL_TYPES.contains(entry.name)) {
+            arclight$reentrant = wrap = true;
+         } else {
+            wrap = false;
+         }
+         if (wrap) {
+            p_197484_0_.writeUtf("arclight:wrapped");
+         }
          p_197484_0_.writeResourceLocation(entry.name);
-         entry.serializer.serializeToNetwork(p_197484_1_, p_197484_0_);
+         PacketBuffer buf = wrap ? new PacketBuffer(io.netty.buffer.Unpooled.buffer()) : p_197484_0_;
+         entry.serializer.serializeToNetwork(p_197484_1_, buf);
+         if (wrap) {
+            p_197484_0_.writeVarInt(buf.writerIndex());
+            p_197484_0_.writeBytes(buf);
+            arclight$reentrant = false;
+         }
+         // CatServer end
       }
    }
 
@@ -219,5 +_,9 @@
          this.serializer = p_i48088_2_;
          this.name = p_i48088_3_;
       }
+   }
+   @javax.annotation.Nullable public static ResourceLocation getId(ArgumentType<?> type) {
+      Entry<?> entry = get(type);
+      return entry == null ? null : entry.name;
    }
 }
