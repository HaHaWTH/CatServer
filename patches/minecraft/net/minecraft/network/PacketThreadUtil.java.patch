--- a/net/minecraft/network/PacketThreadUtil.java
+++ b/net/minecraft/network/PacketThreadUtil.java
@@ -1,5 +_,7 @@
 package net.minecraft.network;
 
+import net.minecraft.network.play.ServerPlayNetHandler;
+import net.minecraft.server.MinecraftServer;
 import net.minecraft.util.concurrent.ThreadTaskExecutor;
 import net.minecraft.world.server.ServerWorld;
 import org.apache.logging.log4j.LogManager;
@@ -15,6 +_,7 @@
    public static <T extends INetHandler> void ensureRunningOnSameThread(IPacket<T> p_218797_0_, T p_218797_1_, ThreadTaskExecutor<?> p_218797_2_) throws ThreadQuickExitException {
       if (!p_218797_2_.isSameThread()) {
          p_218797_2_.execute(() -> {
+            if (MinecraftServer.getServer().hasStopped() || (p_218797_1_ instanceof ServerPlayNetHandler && ((ServerPlayNetHandler) p_218797_1_).isDisconnected())) return; // CraftBukkit, MC-142590
             if (p_218797_1_.getConnection().isConnected()) {
                p_218797_0_.handle(p_218797_1_);
             } else {
@@ -24,5 +_,10 @@
          });
          throw ThreadQuickExitException.RUNNING_ON_DIFFERENT_THREAD;
       }
+      // CraftBukkit start - SPIGOT-5477, MC-142590
+      else if (MinecraftServer.getServer().hasStopped() || (p_218797_1_ instanceof ServerPlayNetHandler && ((ServerPlayNetHandler)p_218797_1_).isDisconnected())) {
+         throw ThreadQuickExitException.RUNNING_ON_DIFFERENT_THREAD;
+      }
+      // CraftBukkit end
    }
 }
