--- a/net/minecraft/world/gen/surfacebuilders/ValleySurfaceBuilder.java
+++ b/net/minecraft/world/gen/surfacebuilders/ValleySurfaceBuilder.java
@@ -41,7 +_,7 @@
       BlockPos.Mutable blockpos$mutable = new BlockPos.Mutable();
       BlockState blockstate2 = p_205610_2_.getBlockState(blockpos$mutable.set(j, 128, k));
 
-      for(int j1 = 127; j1 >= 0; --j1) {
+      for(int j1 = p_205610_6_; j1 >= 0; --j1) {
          blockpos$mutable.set(j, j1, k);
          BlockState blockstate3 = p_205610_2_.getBlockState(blockpos$mutable);
          if (blockstate2.is(p_205610_9_.getBlock()) && (blockstate3.isAir() || blockstate3 == p_205610_10_)) {
